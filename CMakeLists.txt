cmake_minimum_required(VERSION 3.5...4.0)
project(python-from-fortran LANGUAGES CXX Fortran)
add_executable(f main.f90)
add_executable(cpp main.cpp)
execute_process(COMMAND conda info --base OUTPUT_VARIABLE CONDA_PREFIX OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process(COMMAND ${CONDA_PREFIX}/bin/python --version OUTPUT_VARIABLE PYTHON_VERSION OUTPUT_STRIP_TRAILING_WHITESPACE)
string(REGEX REPLACE "^.* " "" PYTHON_VERSION "${PYTHON_VERSION}")
string(REGEX REPLACE "\.[0-9]+$" "" PYTHON_VERSION_MAJOR "${PYTHON_VERSION}")
message(STATUS "CONDA_PREFIX ${CONDA_PREFIX}")
message(STATUS "PYTHON_VERSION ${PYTHON_VERSION}")
message(STATUS "PYTHON_VERSION_MAJOR ${PYTHON_VERSION_MAJOR}")
target_include_directories(cpp PRIVATE ${CONDA_PREFIX}/include/python${PYTHON_VERSION_MAJOR})
target_link_libraries(cpp PRIVATE python${PYTHON_VERSION_MAJOR})
target_link_directories(cpp PRIVATE ${CONDA_PREFIX}/lib)
set_property(TARGET cpp PROPERTY CXX_STANDARD 17)
file(COPY pythonfile.py DESTINATION .)